name: Publish Resume

on:
  push:
    branches:
      - main

defaults:
  run:
    working-directory: .

jobs:
  build_resume:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@latest

      - name: Get Latest Tag
        id: get_tag
        run: |
          # Fetch all tags
          git fetch --tags
          # Get the latest tag
          LATEST_TAG=$(git describe --tags --abbrev=0 || echo "0")
          echo "Latest Tag: $LATEST_TAG"
          echo "::set-output name=version::$LATEST_TAG"

      - name: Increment Version
        id: increment_version
        run: |
          # Extract version number from tag (assuming format like v1, v2, etc.)
          VERSION=$(echo "${{ steps.get_tag.outputs.version }}" | sed 's/^v//')
          NEXT_VERSION=$((VERSION + 1))
          NEXT_TAG="v$NEXT_VERSION"
          echo "Next Tag: $NEXT_TAG"
          echo $NEXT_TAG > next_tag.txt
          echo "::set-output name=version::$NEXT_TAG"

      - name: Convert to PDF
        uses: xu-cheng/latex-action@3.2.0
        with:
          root_file: Ayush_Jaipuriyar_resume.tex

      - name: Create Release
        uses: softprops/action-gh-release@v2.0.8
        with:
          files: Ayush_Jaipuriyar_resume.pdf
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        id: release
